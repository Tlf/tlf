
This is a short intro for Tlf QTC handling.
Ervin Hegedus HA2OS, 2014.
airween@gmail.com


Introduction
============

QTC handling was maded for WAEDC contest for Tlf. It doesn't need
any external tool, Tlf supports it out of box. To enable that,
you only needs to put a "QTC=" option to logcfg.dat. This parameter
needs a value, which could be one of these: "RECV", "SEND", or
"BOTH". These values means you only want to receive or send
QTC's, or you want to send AND receive QTC's (for example, in
RTTY mode). Note, that currently only RECV and SEND mode are
implemented. BOTH will used for RTTY mode.


QTC window
==========

When you enabled the QTC handling in logcfg.dat, you can open the 
QTC window from either field: callsign or exchange, it doesn't matter. i
To open it, just press CTRL+Q. If you want to close is, just simple
press ESC. The window is divided to 2 side: the left side
contains the QTC's data, the right side contains the help information.

The data side contains the following QTC's fields:
* QTC callsign - 14 characters, allowed: alphanums, digits, /
* QTC serial - 4 characters, allowed: digits,
* number of QSO in current QTC block - 2 characters, allowed:
  digits
* 10 QSO lines in RECV mode:
  * time - 4 characters, allowed: digits, ?
  * callsign - 14 characters, allowed: alphanums, digits, /, ?
  * serial - 4 characters, allowed: digits, ?
* 10 QSO lines in SEND mode:
  * every line generated by the QSO's, all of them are formatted
    for three fields: time, callsign and serial

This side contains many "meta" information:
* at right of the QTC callsign field, Tlf shows the QTC info of
  current station: how many QTC has it; if the callsign field
  in main window is empty, the last callsign will be picked up.
  When the station has not send or received any QTC yet, there 
  will be: "Received 0 QTC", or "Sent 0 QTC". If you had
  exchanged any QTC with the station, the message will read
  "Received 3 QTC" or "Sent 5 QTC".
* if you type the number of QSO in the QTC block in RECV mode,
  Tlf will show its number at the beginning of every line; if the
  station indicates that it will send to you 6 QSO, and you type
  it in that field, Tlf will put a digit to the begin of first 6
  lines
* if you type the number of QSO in the QTC block in SEND mode,
  Tlf will find the next number QSO, which doesn't contain the
  current callsign (see contest rules 7.2). Note, that if you
  don't have eonugh QSO, you can't send the maximum (10), eg.
  you have only 9 QSO. If you type greater number than available
  QTC number, the field value will be aligned to maximum number!
* in RECV mode, every QSO line has a status, which could be:
  "invalid", "valid", "confirmed". This status is indicated by a
  sign at the end of the line. When a line is invalid, you can
  see a "?", if the line is valid, then there isn't any character,
  and finally, if the QSO line had been confirmed, you can see
  a "*" sign
* in SEND mode, if you've sent a QTC line (with ENTER), at the
  end of the line you will see a "*" character, which means,
  you've sent that QTC


Navigation between the fields
=============================

You can move to any field as you want and when you want. There
isn't a mandatory order, but the navigation keys doesn't works in
all cases. Normally, with TAB you can move to the next field,
and Shift+TAB goes back. 
There is an exception: TAB will notleave the current QSO line, 
untill you confirm the line. Instead it takes you to the time field, 
if you are in the exchange field, and Shift+TAB does it in reverse order.
With UP and DOWN cursor keys you can go to up or down.

In RECV mode with SPACE, you can navigate between the fields in one
line, for faster move, so that mean the SPACE and TAB are equals
in this mode, in QTC line.


Navigation in a field
=====================

If you press an allowed character in a field, that will be
displayed, and the cursor will go right to the next place. If you
press a not allowed character, then nothing happens. The
BACKSPACE key deletes the next charaters to left, and move the
right part to left. DELETE key deletes the current character as
you're staying, and shifts the characters to left at the next to
right. As I described above, the SPACE move the cursor to the next
field (or first, if you are in last field) inside of QTC line, in
RECV mode.


Storing QTC's
=============

Tlf stores QTC's in two files. The received QTC's are stored in
QTC_recv.log, sent QTC's are stored in QTC_sent.log. These logfiles
will created automatically, when Tlf starts.


Receiving QTC
=============

If the station asks you, if are you QRV for QTC, you can press
CTRL+Q, it doesn't matter in which field are you: callsign or
exchange. As another way, you an open the QTC window (CTRL+Q), 
and press F1 to ask for QTC - it is configured in rule file to 
send "QTC?".

If the callsign fields isn't empty, the content of that field
will be copied. Otherwise the callsign of the last QSO will be
copied. If the station sent you some QTC previously, you can 
see the number of QTC QSO's, eg. "Received 3 QTC". 
You can receive at maximum 10 QTC from every station. If you 
have 3 QTC from a station, then you can receive 7 QTC more. 
If you type more than 7, Tlf will replace the number to 7.

Afterwards you can fill the QTC serial, and number of QSO's. 
What you type in as number of QSO's will be used by Tlf to number
that many lines, to show you, how many lines remains.

If you filled the callsign, serial and number fields (all three
fields are required), and then press ENTER, Tlf will send the 
F2 message, which is "QRV" normally, so you don't need to send 
it manually.

If you start to receive the QTC's, you need to fill 3 fields:
time (HHMM, as hour and minutes), callsign and serial. If you
only enters part of a line, that line will be marked as 
"incomplete", which you can see by the "?" at the end of the line.

If you fill the time field (4 digits), the cursor will go to
the callsign field. Fill that field, and press TAB to move the
next one. If you put there at least 1 digit, Tlf recognize
that line s complete and the "?" will disappear at the end of 
the line.

If you press SPACE in any field, the cursor will go to the next
field (or first, if the current is the exchange number).

Important: in any fields you can type "?", eg: "111?" in time
field, or "W?" in callsign field. That mean, you couldn't receive
that letter. Then you fill all fields vainly, the line remain as
incomplete. Otherwise Tlf assumes the line is complete.

This is important, because when you press the ENTER, Tlf will
send the answer to the station based the status of the line. If the
line is incomplete, Tlf sends "AGN" message, but if it's
complete, it sends "R".

If you could receive the line, and pressed ENTER, and Tlf
sent the "R" signal, then you will see a "*" at the end of the
line. That means, you received the QTC line from the station.

If you want to ask only one field (eg. only callsign), then you
need just press F5 (TIME?), F6 (CALL?), or F7 (NR?). If you want
to ask the complete QTC line, you can press F8 (AGN).

When you received a QTC, the cursor goes to the start of the 
next line, and you can continue to receive QTC.

If you received the last line, and all lines are complete,
after teh last ENTER Tlf will close the QTC window, and send 
"QSL ALL" message to the station.

At this time the QTC data will be written to the logfile on 
disk, fields will be flushed, and if there is configured any
other node in logcfg.dat, the QTC lines will be sent to them.

On other nodes, Tlf will also write the QTC's to its own
logfiles.

If you press ESC before you receive the QTC block, the data isn't
lost. Tlf flush's the fields only in these cases:
* you received all QSO's, and saved to disc
* pressed ESC, and changed regular callsign field

Note, that Tlf send the "QRV" message only in case the
fields are empty. Keep in mind, if you've pressed ESC, and CTRL+Q
again, all data remains, and "QRV" message will NOT be send.


Sending QTC
=============

If the other station asks you for QTC's, you can press CTRL+Q, 
it doesn't matter in which field are you: callsign or exchange. 
When the QTC window openes, you can press F2 and Tlf will send 
the message: "QTC sr/nr" with "sr" and "nr" replaced with the i
serial and number of lines in QTC, example: "QTC 3/8".

If the callsign fields isn't empty, the content of that field
will be copied. Otherwise, the callsign of the last QSO will be 
used. If the station received QTC's previously, you can see the 
number of QTC's on the current band, eg. "Sent 3 QTC". You can send
maximum 10 QTC to every station. If you sent 3 QTC to a station,
you can send maximum 7 QTC in next block. If you type more, than
7, Tlf will replace the number to 7, and of course, only 7 QSO
will be shown. If you don't have enough QSO, Tlf also will replace
this value to the number of the available QSO.

The QTC serial field will be filled automatically, you just need
to set up, how many QTC's you want to send. Note, that Tlf looks 
for the current callsign, and that will be excluded from the QTC list!
If you modify the callsign field, Tlf will hide some lines, which
matches the actually callsign, but don't afraid: if you finish
the modification of field, you can see the available list.

If you don't want to send the maximum available QTC lines, just
edit the number field, and Tlf will gives only that many QTC lines.

Now, you can move to the 1st QTC line with DOWN cursor. If you press
ENTER, Tlf will send the current QTC, and will put a "*" char
to the end of the line. It shows you, that QTC line had been sent.

Now just press DOWN and ENTER, if the station gives "R" sign. If
it asks to send the last QTC again, just simple press UP and ENTER
again. With the DEL key you can delete the "SENT" flag from the
end of the line.

If you sent all lines, and ithe station confirms them, you can press
the CTRL+S (like in most software), and Tlf will save the block.
After 2 seconds the window will be closed, and you can go away.

At this time the QTC data will be written to the logfile on the
disk, callsign and number fields will be flushed, and if there
is any other node configured in logcfg.dat, the QTC lines will
be sent to them.

On the other nodes, Tlf will also write the QTC's to its own
logfiles.

If you press ESC before you receive the QTC block, the data isn't
lost. Tlf flushre's the fields only in the following case:
* you sent all QTC's, and saved them to disc



Showing QTC capable stations 
============================

After you sent or received a QTC block from or to a station, Tlf
writes it to the log, but stores it in memory too. If
you meet that station on another bands, and use "Worked window",
then you can see, how many QTC's had been exchanged with the station
on each band.

There is a "Q" letter on the upper border of "Worked window", and in
that column there are the number of QTC's. If there is a "0" in a
line, that means you sent to or received no QTC from that
station. If there is a "Q", that means you sent to or received
from the station the maximum number of QTC (10).

This information also is visible in the cluster info, if you use that.
At the end of the callsign in bandmap, you can see a "0", "Q" or
any digit, which means same as above, eg "DL1A  Q", or "HA5A  3".


Preparing CABRILLO
==================

When you finished the contest, just use the ":wri" command to save 
your log in Cabrillo format. (It's a good idea to exit from Tlf, 
and start it again - this is only need to recalc correct points, 
nothing else.)

Now leave Tlf, and run the "qtcmerge.py" script, which is part
of Tlf, and has been installed to your INSTALLDIR/share/tlf, 
eg. /usr/local/share/tlf. The normal way to run this script 
from the Tlf contest directory is:

/usr/local/share/tlf/qtcmerge.py YOURCALL.cbr

The script reads your saved Cabrillo file and your QTC's and 
saves them to a new file, in Cabrillo format. The new file name 
will be YOURCALL_QTC.cbr. Make a backup of the original file, 
rename the new one to YOURCALL.cbr and send it to the contest 
organizers.

Note: You can find more info about the QTC cabrillo format
here:
http://dl0tud.tu-dresden.de/~dj1yfk/qtcs/
http://www.kkn.net/~trey/cabrillo/qso-template.html


Shortkey summary
================

* CTRL+Q - open QTC window
* ESC - close QTC window
* TAB - move to the next field
* SPACE - move to the next field in QTC line, in RECV mode
* Shift+TAB - move to the previous field
* UP, DOWN - move up or down
* BACKSPACE - delete the next char left
* DELETE - delete the current position, shift left the rest of line
* ENTER - send "R" or "AGN" to station

If you have any question, just send an e-mail to me or the Tlf develop
list.


73,

Ervin
HA2OS

